# API Integration Points for KinoSwap

This document outlines all the API endpoints that need to be implemented on the backend for the KinoSwap collaborative MovieMeta selection service.

## Overview

The frontend makes HTTP requests to these endpoints and expects JSON responses. All endpoints should be prefixed with `/api/`.

## Room Management

### 1. Create Room

**Endpoint:** `POST /api/rooms`
**Description:** Creates a new room for MovieMeta voting
**Request Body:** None (or optional host preferences)
**Response:**

```json
{
  "roomId": "123456",
  "hostId": "user-uuid",
  "createdAt": "2024-01-01T00:00:00Z"
}
```

**Frontend Location:** `client/pages/Index.tsx` - `handleCreateRoom` function

### 2. Join Room

**Endpoint:** `POST /api/rooms/{roomId}/join`
**Description:** Allows a user to join an existing room
**Request Body:**

```json
{
  "userId": "user-uuid" // optional, can be generated by backend
}
```

**Response:**

```json
{
  "success": true,
  "userId": "user-uuid",
  "participants": 3
}
```

**Frontend Location:** `client/pages/Index.tsx` - `handleJoinRoom` function

### 3. Get Room Status

**Endpoint:** `GET /api/rooms/{roomId}`
**Description:** Gets current room information and participant count
**Response:**

```json
{
  "roomId": "123456",
  "participants": 3,
  "readyParticipants": 1,
  "status": "waiting", // "waiting", "voting", "results"
  "hostId": "user-uuid"
}
```

## User Preferences

### 4. Submit Preferences

**Endpoint:** `POST /api/rooms/{roomId}/preferences`
**Description:** User submits their MovieMeta preferences
**Request Body:**

```json
{
  "userId": "user-uuid",
  "preferences": "–∫–æ–º–µ–¥–∏—è —Å –î–∂–∏–º–æ–º –ö–µ—Ä—Ä–∏, —á—Ç–æ-—Ç–æ –ª–µ–≥–∫–æ–µ –∏ —Å–º–µ—à–Ω–æ–µ –Ω–∞ –≤–µ—á–µ—Ä"
}
```

**Response:**

```json
{
  "success": true,
  "readyParticipants": 2
}
```

**Frontend Location:** `client/pages/Lobby.tsx` - `handleReady` function

## Voting Management

### 5. Start Voting

**Endpoint:** `POST /api/rooms/{roomId}/start-voting`
**Description:** Host starts the voting process, generates MovieMeta batch
**Request Body:**

```json
{
  "hostId": "user-uuid"
}
```

**Response:**

```json
{
  "success": true,
  "MovieMetas": [
    {
      "id": "MovieMeta-1",
      "title": "The Mask",
      "poster": "https://example.com/poster.jpg",
      "duration": "101 min",
      "genre": ["Comedy", "Fantasy"],
      "description": "A timid bank teller discovers an ancient mask..."
    }
  ]
}
```

**Frontend Location:** `client/pages/Lobby.tsx` - `handleStartVoting` function

### 6. Submit Vote

**Endpoint:** `POST /api/rooms/{roomId}/vote`
**Description:** User votes on a MovieMeta (like/dislike)
**Request Body:**

```json
{
  "userId": "user-uuid",
  "MovieMetaId": "MovieMeta-1",
  "vote": "like" // "like" or "dislike"
}
```

**Response:**

```json
{
  "success": true,
  "remaining": 5 // remaining MovieMetas to vote on
}
```

### 7. Get Voting Results

**Endpoint:** `GET /api/rooms/{roomId}/results`
**Description:** Gets the voting results after all users have voted
**Response:**

```json
{
  "matches": [
    {
      "MovieMetaId": "MovieMeta-1",
      "title": "The Mask",
      "poster": "https://example.com/poster.jpg",
      "likeCount": 3,
      "totalVotes": 3
    }
  ],
  "allFinished": true
}
```

### 8. Start New Round

**Endpoint:** `POST /api/rooms/{roomId}/new-round`
**Description:** Start a new voting round with remaining MovieMetas or new batch
**Request Body:**

```json
{
  "hostId": "user-uuid",
  "type": "revote" // "revote" for same MovieMetas, "new_batch" for new MovieMetas
}
```

## Real-time Updates (WebSocket)

### WebSocket Connection

**Endpoint:** `ws://your-domain/rooms/{roomId}`
**Description:** Real-time updates for room participants

**Events to send to frontend:**

- `participant_joined`: New user joined
- `participant_ready`: User submitted preferences
- `voting_started`: Host started voting
- `vote_submitted`: Someone voted (don't reveal vote)
- `voting_finished`: All votes submitted
- `room_reset`: New round started

**Example event:**

```json
{
  "event": "participant_joined",
  "data": {
    "participants": 4,
    "readyParticipants": 2
  }
}
```

## Error Handling

All endpoints should return appropriate HTTP status codes:

- `200`: Success
- `400`: Bad request (invalid room code, etc.)
- `404`: Room not found
- `403`: Not authorized (not host when host action required)
- `409`: Conflict (room full, voting already started, etc.)

Error response format:

```json
{
  "error": "Room not found",
  "code": "ROOM_NOT_FOUND"
}
```

## Telegram Mini App Integration

The frontend expects to receive Telegram user data through:

```javascript
window.Telegram.WebApp.initDataUnsafe.user;
```

This should be sent to the backend for user identification and authentication.

## Current Frontend Implementation Status

‚úÖ **Implemented:**

- Homepage with room creation and joining
- Lobby page with preferences input
- Basic routing between pages

üöß **Placeholder/TODO:**

- Voting page (Tinder-like interface)
- Results page
- WebSocket integration for real-time updates

## Notes for Backend Developer

1. All API calls in the frontend are currently commented out with `// TODO:` comments
2. The frontend currently uses mock data and navigation for demonstration
3. Room codes are 6-digit numbers formatted as XXX-XXX in the UI
4. The app uses Sonner for toast notifications - success/error messages should be handled appropriately
5. Telegram Mini App integration will require the telegram-web-app script and proper initialization
